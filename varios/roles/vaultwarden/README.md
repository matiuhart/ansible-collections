Vaultwarden Ansible Role
=========

This role deploys a docker container with the Vaultwarden password manager solution of dani-garcia. Includes the argon2 admin token generation

To have more detailed info about the Vaultwarden project you can go to:

https://github.com/dani-garcia/vaultwarden

Requirements
------------

As base requirements you need docker, docker-compose installed and some reverse proxy with SSL enabled forwarding the traffic to the container port (5001)

To deploy an SSL reverse proxy you can use this Ansible role:

https://github.com/matiuhart/ansible-collections/blob/master/varios/roles/nginx_ssl_proxy/README.md

Role Variables
--------------

| Variable | Default Value | Requeried | Description |
| ----------- | ----------- | -------- | ----------- |
| vw_install_path | /opt/vaultwarden | no | Vaultwarden deployment path |
| vw_admin_token | null | no | Admin secret token |
| vw_smtp_host | null | no | Email server |
| vw_smtp_port | 465 | no | Email server smtp port |
| vw_smtp_security | force_tls | no | Email server smtp security protocol| 
| vw_smtp_from_name | null | no | Email from name |
| vw_smtp_from_email | null | no | Email from email address |
| vw_smtp_from_user | null | no | Email user |
| vw_smtp_from_user_password | null | no | Email password|

Example Playbook
----------------
In this example, I have defined the `vw_admin_token` variable with an argon2 hash after the first Playbook run, you can leave this variable as undefined (during the first run), and the playbook will generate a random admin token, hashing it with argon2 and save the autogenerated values passwords in in `{{ vw_install_path }}/vw_admin_auto_generated_token.txt`. After this first run, you can copy the `Admin Argon2 hashed token` value and give the value for the `vw_admin_token` variable at the playbook variables definition. It's important to define this value because the playbook will check it and, if has not been set will generate it again.
Also, if you desire it can put any value of argon2 hash or in text plane  format

```
- name: Managing my super server
  hosts: superserver
  become: true
  connection: ssh
  gather_facts: true
  vars:
    vw_install_path: "/home/docker/vaultwarden"
    vw_smtp_host: "smtp.gmail.com"
    vw_smtp_port: "465"
    vw_smtp_security: "force_tls"
    vw_smtp_from_name: "Vaultwarden Ansible Deployment"
    vw_smtp_from_email: "youruser@youremail.com"
    vw_smtp_from_user: "youruser@youremail.com"
    vw_smtp_from_user_password: "yoursuperpassword"

  roles:
    - vaultwarden
```

After the first run, I copied the argon2 hash from `{{ vw_install_path }}/vw_admin_auto_generated_token.txt` and I have added this variable to the playbook:

`vw_admin_token: "$$argon2id$$v=19$$m=65540,t=3,p=4$$JChvcGVuc3NsIHJhbmQgLWJhc2U2NCAzMik$$A69g5MLOxBDB6HLiEH6u4y1LxMugXs66wdoqkb59ASk" `


Author Information
------------------
This is a role created by matiuhart if you want to check some of my collections:

https://github.com/matiuhart/ansible-collections
